<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
<title>ECG Viewer</title>
<style>
body{background:#111;color:#eee;font-family:Arial}
canvas{background:#000;border:1px solid #555}
</style></head>
<body>
<h2>Pediatric 15â€‘Lead ECG (normalized schema)</h2>
Speed<select id="speed"><option value="25">25</option><option value="50">50</option></select>
Gain<select id="gain"><option value="10">10</option><option value="20">20</option></select>
<button id="calBtn">Calipers</button>
<canvas id="c" width="1400" height="900"></canvas>
<script type="module">
import { fetchECG } from "./js/ecg-core.js";

const DATA_URL = "../data/ecg_data.json";

async function main(){
  const meta = await fetchECG(DATA_URL);
  const fs = meta.fs;
  const leads = Object.keys(meta.leads_uV);
  const canvas=document.getElementById("c");
  const ctx=canvas.getContext("2d");
  let caliper=false,pts=[];

  document.getElementById("calBtn").onclick=()=>{caliper=!caliper;};
  canvas.onclick=e=>{
    if(!caliper)return;
    const r=canvas.getBoundingClientRect();
    pts.push({x:e.clientX-r.left,y:e.clientY-r.top});
    if(pts.length==2){
      ctx.strokeStyle="yellow";
      ctx.beginPath();
      ctx.moveTo(pts[0].x,pts[0].y);
      ctx.lineTo(pts[1].x,pts[1].y);
      ctx.stroke();
      pts=[];
    }
  };

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const speed=+document.getElementById("speed").value;
    const gain=+document.getElementById("gain").value;
    const pxPerSec=speed*4,pxPerUv=(gain*4)/1000;
    let y=40;
    leads.forEach(L=>{
      ctx.beginPath();
      meta.leads_uV[L].slice(0,fs*4).forEach((v,i)=>{
        const x=i/fs*pxPerSec,yy=y-v*pxPerUv;
        if(i==0)ctx.moveTo(x,yy);else ctx.lineTo(x,yy);
      });
      ctx.strokeStyle="lime";
      ctx.stroke();
      ctx.fillText(L,10,y);
      y+=55;
    });
  }
  draw();
  setInterval(draw,200);
}

main().catch(err=>{
  console.error(err);
  document.body.insertAdjacentHTML("beforeend", `<pre style="color:red">${err}</pre>`);
});
</script>
</body></html>
